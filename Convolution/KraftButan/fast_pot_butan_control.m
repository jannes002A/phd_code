function [ges_F, grad] = fast_pot_butan_control(atom,c)

% Die Koodianten der Atome müssen als Zeilenvektor übergeben werden
% c ist der Vektor der die Kontrollen steuert, da die Steuerung auf jede 
% Wechselwirkung einwirken soll, muss c also auch wieder eine Matrix sein




% Wechelwirkungen von Butan
%     C1 H1 H2 H3 C2 H4 H5 C3 H6 H7 C4 H8 H9 H10
%  C1 00 12 12 12 13 22 22 23 32 32 33 42 42 42
%  H1 12 00 21 21 23 31 31 42 41 41 42 41 41 41
%  H2 12 21 00 21 23 31 31 42 41 41 42 41 41 41
%  H3 12 21 21 00 23 31 31 42 41 41 42 41 41 41
%  C2 13 23 23 23 00 12 12 13 22 22 23 32 32 32
%  H4 22 31 31 31 12 00 21 22 31 31 42 43 43 43
%  H5 22 31 31 31 12 21 00 22 31 31 42 43 43 43   
%  C3 23 42 42 42 13 22 22 00 12 12 13 22 22 22
%  H6 32 41 41 41 22 31 31 12 00 21 22 31 31 31
%  H7 32 41 41 41 22 31 31 12 21 00 22 31 31 31
%  C4 33 42 42 42 23 42 42 13 22 22 00 12 12 12
%  H8 42 41 41 41 32 43 43 22 31 31 12 00 21 21
%  H9 42 41 41 41 32 43 43 22 31 31 12 21 00 21
% H10 42 41 41 41 32 43 43 22 31 31 12 21 21 00     

WW = [00 12 12 12 13 22 22 23 32 32 33 42 42 42;
      12 00 21 21 23 31 31 42 41 41 42 41 41 41;
      12 21 00 21 23 31 31 42 41 41 42 41 41 41;
      12 21 21 00 23 31 31 42 41 41 42 41 41 41;
      13 23 23 23 00 12 12 13 22 22 23 32 32 32;
      22 31 31 31 12 00 21 22 31 31 42 43 43 43;
      22 31 31 31 12 21 00 22 31 31 42 43 43 43;   
      23 42 42 42 13 22 22 00 12 12 13 22 22 22;
      32 41 41 41 22 31 31 12 00 21 22 31 31 31;
      32 41 41 41 22 31 31 12 21 00 22 31 31 31;
      33 42 42 42 23 42 42 13 22 22 00 12 12 12;
      42 41 41 41 32 43 43 22 31 31 12 00 21 21;
      42 41 41 41 32 43 43 22 31 31 12 21 00 21;
      42 41 41 41 32 43 43 22 31 31 12 21 21 00];

grad = zeros(3,14); 

[~,m]=size(atom);

ges_F = 0; 
K=5;
T=5;
lj=0.01;
for i=1:m
    for j = i+1:m
        %[f,fx,fy,fz] = KraftButan_hom(K,T,atom(:,i),atom(:,j),WW(i,j),0);
        %[f,fx,fy,fz] = KraftButan(K,T,atom(:,i),atom(:,j),WW(i,j));
        
        x=atom(:,i);
        y=atom(:,j);
        
        bound=WW(i,j);
        
        r = (x(1)-y(1))^2+(x(2)-y(2))^2+(x(3)-y(3))^2;

        switch bound
            case 12
            % para(2) == 1 wäre BW HH das nicht existiert
            % da es keine direkte Bindung zwischen zwei Wasserstoffatomen gibt
            % BW CH
            f = K*(r - 1.1^2)^2+c(i,j)*K*(r - 1.1^2)^2;

            fx = 4*(x(1)-y(1))*K*(r - 1.1^2)+c(i,j)*4*(x(1)-y(1))*K*(r - 1.1^2);
            fy = 4*(x(2)-y(2))*K*(r - 1.1^2)+c(i,j)*4*(x(2)-y(2))*K*(r - 1.1^2);
            fz = 4*(x(3)-y(3))*K*(r - 1.1^2)+c(i,j)*4*(x(3)-y(3))*K*(r - 1.1^2);
            case  13
            % BW CC
            f = K*(r - 1.54^2)^2+c(i,j)*K*(r - 1.54^2)^2;

            fx = 4*(x(1)-y(1))*K*(r - 1.54^2)+c(i,j)*4*(x(1)-y(1))*K*(r - 1.54^2);
            fy = 4*(x(2)-y(2))*K*(r - 1.54^2)+c(i,j)*4*(x(2)-y(2))*K*(r - 1.54^2);
            fz = 4*(x(3)-y(3))*K*(r - 1.54^2)+c(i,j)*4*(x(3)-y(3))*K*(r - 1.54^2);
            case 21
            % B! (1,3 Wechselwirkung) HH
            f = K*(r - 1.78^2)^2+c(i,j)*K*(r - 1.78^2)^2;

            fx = 4*(x(1)-y(1))*K*(r - 1.78^2)+c(i,j)*4*(x(1)-y(1))*K*(r - 1.78^2);
            fy = 4*(x(2)-y(2))*K*(r - 1.78^2)+c(i,j)*4*(x(2)-y(2))*K*(r - 1.78^2);
            fz = 4*(x(3)-y(3))*K*(r - 1.78^2)+c(i,j)*4*(x(3)-y(3))*K*(r - 1.78^2);
            case 22
            % B! (1,3 Wechselwirkung) CH
            f = K*(r - 2.19^2)^2+c(i,j)*K*(r - 2.19^2)^2;

            fx = 4*(x(1)-y(1))*K*(r -2.19^2)+c(i,j)*4*(x(1)-y(1))*K*(r -2.19^2);
            fy = 4*(x(2)-y(2))*K*(r -2.19^2)+c(i,j)*4*(x(2)-y(2))*K*(r -2.19^2);
            fz = 4*(x(3)-y(3))*K*(r -2.19^2)+c(i,j)*4*(x(3)-y(3))*K*(r -2.19^2);
            case 23
            % B! (1,3 Wechselwirkung) CC
            f = K*(r - 2.6^2)^2+c(i,j)*K*(r - 2.6^2)^2;

            fx = 4*(x(1)-y(1))*K*(r - 2.6^2)+c(i,j)*4*(x(1)-y(1))*K*(r - 2.6^2);
            fy = 4*(x(2)-y(2))*K*(r - 2.6^2)+c(i,j)*4*(x(2)-y(2))*K*(r - 2.6^2);
            fz = 4*(x(3)-y(3))*K*(r - 2.6^2)+c(i,j)*4*(x(3)-y(3))*K*(r - 2.6^2);
            case 31
            %TJ (1,4 Wechslewirkung) HH
            %dHH60 =  1.06^2 + 2*1.54*1.06*((cos(109.5*(2*pi/360))*cos(109.5*(2*pi/360))) - 1/2 * (sin(109.5*(2*pi/360))*sin(109.5*(2*pi/360)))) + 1.06^2 - 2*1.54*1.06*cos(109.5*(2*pi/360));
            %dHH180 = 1.06^2 + 2*1.54*1.06 + 1.06^2 - 2*1.54*1.06*cos(109.5*(2*pi/360));
            % Abstände bestimmt mit der Funktion von Marcus
            % HCCH
            % [d60, d180]=torsion_distance(1.06, 1.54, 1.06) 
            dHH60 = 2.5;
            dHH180 = 3.1;
            f = lj*(7220/r^6 - 76/r^3) +  T*(r-dHH60^2)^2 *(r-dHH180^2)^2+c(i,j)*lj*(7220/r^6 - 76/r^3) +  T*(r-dHH60^2)^2 *(r-dHH180^2)^2;

            fx = lj*( (6*76*(x(1)-y(1)))/r^4  -  (12*7220*(x(1)-y(1)))/r^7 ) +  4*T*(x(1)-y(1))*((r-dHH60^2) * (r-dHH180^2)^2 + ((r-dHH60^2)^2 *(r-dHH180^2)))+c(i,j)*lj*( (6*76*(x(1)-y(1)))/r^4  -  (12*7220*(x(1)-y(1)))/r^7 ) +  4*T*(x(1)-y(1))*((r-dHH60^2) * (r-dHH180^2)^2 + ((r-dHH60^2)^2 *(r-dHH180^2)));
            fy = lj*( (6*76*(x(2)-y(2)))/r^4  -  (12*7220*(x(2)-y(2)))/r^7 ) +  4*T*(x(2)-y(2))*((r-dHH60^2) * (r-dHH180^2)^2 + ((r-dHH60^2)^2 *(r-dHH180^2)))+c(i,j)*lj*( (6*76*(x(2)-y(2)))/r^4  -  (12*7220*(x(2)-y(2)))/r^7 ) +  4*T*(x(2)-y(2))*((r-dHH60^2) * (r-dHH180^2)^2 + ((r-dHH60^2)^2 *(r-dHH180^2)));
            fz = lj*( (6*76*(x(3)-y(3)))/r^4  -  (12*7220*(x(3)-y(3)))/r^7 ) +  4*T*(x(3)-y(3))*((r-dHH60^2) * (r-dHH180^2)^2 + ((r-dHH60^2)^2 *(r-dHH180^2)))+c(i,j)*lj*( (6*76*(x(3)-y(3)))/r^4  -  (12*7220*(x(3)-y(3)))/r^7 ) +  4*T*(x(3)-y(3))*((r-dHH60^2) * (r-dHH180^2)^2 + ((r-dHH60^2)^2 *(r-dHH180^2)));
            case 32
            % TJ (1,4 Wechslewirkung) CH 
            % dCH60 =  1.1^2 + 2*1.54*1.1*((cos(109.5*(2*pi/360))*cos(109.5*(2*pi/360))) - 1/2*(sin(109.5*(2*pi/360))*sin(109.5*(2*pi/360)))) + 1.54^2 - 2* 1.54 * 1.1*cos(109.5*(2*pi/360));
            % dCH180 = 1.1^2 + 2*1.54*1.1 + 1.54^2 -2*1.54*1.1*cos(109.5*(2*pi/360));
            % Abstände bestimmt mit der Funktion von Marcus
            % CCCH
            % [d60, d180]=torsion_distance(1.54, 1.54, 1.06) 
            dCH60 = 3.58;
            dCH180 = 8.1;
            f = lj*(37430/r^6 - 127.4/r^3) + T*(r-dCH60^2)^2*(r-dCH180^2)^2+c(i,j)*lj*(37430/r^6 - 127.4/r^3) + T*(r-dCH60^2)^2*(r-dCH180^2)^2;

            fx = lj*((6*127.4*(x(1)-y(1)))/r^4 - (12*37430*(x(1)-y(1)))/r^7 ) + 4*T*(x(1)-y(1))*((r-dCH60^2) * (r-dCH180^2)^2 + ((r-dCH60^2)^2 *(r-dCH180^2)))+c(i,j)*lj*((6*127.4*(x(1)-y(1)))/r^4 - (12*37430*(x(1)-y(1)))/r^7 ) + 4*T*(x(1)-y(1))*((r-dCH60^2) * (r-dCH180^2)^2 + ((r-dCH60^2)^2 *(r-dCH180^2)));
            fy = lj*((6*127.4*(x(2)-y(2)))/r^4 - (12*37430*(x(2)-y(2)))/r^7 ) + 4*T*(x(2)-y(2))*((r-dCH60^2) * (r-dCH180^2)^2 + ((r-dCH60^2)^2 *(r-dCH180^2)))+c(i,j)*lj*((6*127.4*(x(2)-y(2)))/r^4 - (12*37430*(x(2)-y(2)))/r^7 ) + 4*T*(x(2)-y(2))*((r-dCH60^2) * (r-dCH180^2)^2 + ((r-dCH60^2)^2 *(r-dCH180^2)));
            fz = lj*((6*127.4*(x(3)-y(3)))/r^4 - (12*37430*(x(3)-y(3)))/r^7 ) + 4*T*(x(3)-y(3))*((r-dCH60^2) * (r-dCH180^2)^2 + ((r-dCH60^2)^2 *(r-dCH180^2)))+c(i,j)*lj*((6*127.4*(x(3)-y(3)))/r^4 - (12*37430*(x(3)-y(3)))/r^7 ) + 4*T*(x(3)-y(3))*((r-dCH60^2) * (r-dCH180^2)^2 + ((r-dCH60^2)^2 *(r-dCH180^2)));

            case 33
            % TJ (1,4 Wechselwirkungen) CC
            %dCC60 =  1.54^2+2*1.54^2*((cos(109.5*(2*pi/360))*cos(109.5*(2*pi/360))) - 1/2*(sin(109.5*(2*pi/360))*sin(109.5*(2*pi/360))) ) + 1.54^2 - 2*1.54^2*cos(109.5*(2*pi/360));
            %dCC180 = 1.54^2 + 2*1.54^2 + 1.54^2 - 2*1.54^2 * cos(109.5*(2*pi/360));
            % CCCC
            % [d60, d180]=torsion_distance(1.54, 1.54, 1.54)
            dCC60 = 4.74;
            dCC180 = 11.1;
            f = lj*(285800/r^6 -372.5/r^3) + T*(r-dCC60^2)^2*(r-dCC180^2)^2+c(i,j)*lj*(285800/r^6 -372.5/r^3) + T*(r-dCC60^2)^2*(r-dCC180^2)^2; 

            fx = lj*((6*372.5*(x(1)-y(1)))/r^4-(12*285800*(x(1)-y(1)))/r^7) + 4*T*(x(1)-y(1))*((r-dCC60^2) * (r-dCC180^2)^2 + ((r-dCC60^2)^2 *(r-dCC180^2)))+c(i,j)*lj*((6*372.5*(x(1)-y(1)))/r^4-(12*285800*(x(1)-y(1)))/r^7) + 4*T*(x(1)-y(1))*((r-dCC60^2) * (r-dCC180^2)^2 + ((r-dCC60^2)^2 *(r-dCC180^2)));
            fy = lj*((6*372.5*(x(2)-y(2)))/r^4-(12*285800*(x(2)-y(2)))/r^7) + 4*T*(x(2)-y(2))*((r-dCC60^2) * (r-dCC180^2)^2 + ((r-dCC60^2)^2 *(r-dCC180^2)))+c(i,j)*lj*((6*372.5*(x(2)-y(2)))/r^4-(12*285800*(x(2)-y(2)))/r^7) + 4*T*(x(2)-y(2))*((r-dCC60^2) * (r-dCC180^2)^2 + ((r-dCC60^2)^2 *(r-dCC180^2)));
            fz = lj*((6*372.5*(x(3)-y(3)))/r^4-(12*285800*(x(3)-y(3)))/r^7) + 4*T*(x(3)-y(3))*((r-dCC60^2) * (r-dCC180^2)^2 + ((r-dCC60^2)^2 *(r-dCC180^2)))+c(i,j)*lj*((6*372.5*(x(3)-y(3)))/r^4-(12*285800*(x(3)-y(3)))/r^7) + 4*T*(x(3)-y(3))*((r-dCC60^2) * (r-dCC180^2)^2 + ((r-dCC60^2)^2 *(r-dCC180^2)));
            case 41
            % LJ HH
            f = (7220/r^6 - 76/r^3)+c(i,j)*(7220/r^6 - 76/r^3);

            fx = (6*76*(x(1)-y(1)))/r^4  -  (12*7220*(x(1)-y(1)))/r^7+c(i,j)*(6*76*(x(1)-y(1)))/r^4  -  (12*7220*(x(1)-y(1)))/r^7;
            fy = (6*76*(x(2)-y(2)))/r^4  -  (12*7220*(x(2)-y(2)))/r^7+c(i,j)*(6*76*(x(2)-y(2)))/r^4  -  (12*7220*(x(2)-y(2)))/r^7;
            fz = (6*76*(x(3)-y(3)))/r^4  -  (12*7220*(x(3)-y(3)))/r^7+c(i,j)*(6*76*(x(3)-y(3)))/r^4  -  (12*7220*(x(3)-y(3)))/r^7;

            case 42
            % LJ CH
            f = (37430/r^6 - 127.4/r^3)+c(i,j)*(37430/r^6 - 127.4/r^3);

            fx = (6*127.4*(x(1)-y(1)))/r^4 - (12*37430*(x(1)-y(1)))/r^7+c(i,j)*(6*127.4*(x(1)-y(1)))/r^4 - (12*37430*(x(1)-y(1)))/r^7;
            fy = (6*127.4*(x(2)-y(2)))/r^4 - (12*37430*(x(2)-y(2)))/r^7+c(i,j)*(6*127.4*(x(2)-y(2)))/r^4 - (12*37430*(x(2)-y(2)))/r^7;
            fz = (6*127.4*(x(3)-y(3)))/r^4 - (12*37430*(x(3)-y(3)))/r^7+c(i,j)*(6*127.4*(x(3)-y(3)))/r^4 - (12*37430*(x(3)-y(3)))/r^7;

            case 43
            % LJ CC
            f=(285800/r^6 - 372.5/r^3)+c(i,j)*(285800/r^6 - 372.5/r^3); 

            fx = (6*372.5*(x(1)-y(1)))/r^4-(12*285800*(x(1)-y(1)))/r^7+c(i,j)*(6*372.5*(x(1)-y(1)))/r^4-(12*285800*(x(1)-y(1)))/r^7;
            fy = (6*372.5*(x(2)-y(2)))/r^4-(12*285800*(x(2)-y(2)))/r^7+c(i,j)*(6*372.5*(x(2)-y(2)))/r^4-(12*285800*(x(2)-y(2)))/r^7;
            fz = (6*372.5*(x(3)-y(3)))/r^4-(12*285800*(x(3)-y(3)))/r^7+c(i,j)*(6*372.5*(x(3)-y(3)))/r^4-(12*285800*(x(3)-y(3)))/r^7;
            otherwise
            f = 0;

            fx = 0;
            fy = 0;
            fz = 0;
        end
        ges_F = ges_F + f;
        
        grad(1,i) = grad(1,i) + fx;
        grad(2,i) = grad(2,i) + fy;
        grad(3,i) = grad(3,i) + fz;
        
        grad(1,j) = grad(1,j) - fx;
        grad(2,j) = grad(2,j) - fy;
        grad(3,j) = grad(3,j) - fz;
    end
end

grad =  grad(:);